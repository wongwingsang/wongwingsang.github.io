<!DOCTYPE html>
<html>
<head>
	<title>Where am I</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
  		integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
 		crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
		integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
		crossorigin=""></script>
	<style>
		body{
			padding: 1%;
			margin: 0;
		}
		html, body, #map{
 	   		height: 60vh;
    		width: 80vw;
		}
	</style>
</head>
<body>
	
	<a href="index.html">back to HOME</a>
	<h1>Where am I?</h1>
	<button id="find-me">Show my location</button>
	<button id="keep-watch">keep watching my location</button>
	<button id="stop-watch">stop watching</button>
	<p id = "status"></p>
	<p id = "heading"></p>
	<a id = "map-link" target="_blank"></a><br/>
	<div id="map"></div>
	

	<script>
		// setup the map
		const map = L.map('map',{center:[0,0],zoom: 2,});
		const marker = L.marker([0, 0]).addTo(map);

		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
			maxZoom: 18,
			id: 'mapbox/streets-v11',
			tileSize: 512,
			zoomOffset: -1,
			accessToken: 'pk.eyJ1Ijoic3Vubnl3b25nd3MiLCJhIjoiY2wzZHM3ejZwMGJqNDNtcHJzbjg3enRkNCJ9.xxoXiVlJOXyoSr1QFQ0gFg'
		}).addTo(map);

		const status = document.querySelector('#status');
		const mapLink = document.querySelector('#map-link');
		const heading = document.querySelector('#heading');

		function success(position) {
			// console.log(position)
			const latitude  = position.coords.latitude;
			const longitude = position.coords.longitude;
			const heading = position.coords.heading;

			status.textContent = 'location fund: ';
			// mapLink.href = `https://www.openstreetmap.org/#map=18/${latitude}/${longitude}`;
			mapLink.href = `https://www.google.com/maps/place/${latitude},${longitude}`;
			mapLink.textContent = `Latitude: ${latitude} °, Longitude: ${longitude} °`;
			heading.textContent = 'Heading: ${heading}';

			marker.setLatLng([latitude, longitude]);
			map.setView([latitude, longitude], 18);

			}

		function error(error) {
			status.textContent = 'Unable to retrieve your location';
			// Display error based on the error code.
			const { code } = error;
			switch (code) {
				case GeolocationPositionError.TIMEOUT:
				break;
				case GeolocationPositionError.PERMISSION_DENIED:
				break;
				case GeolocationPositionError.POSITION_UNAVAILABLE:
				break;
			}
		}

		// show the location once
		function geoFindMe() {

			mapLink.href = '';
			mapLink.textContent = '';

			if(!navigator.geolocation) {
				status.textContent = 'Geolocation is not supported by your browser';
			} else {
				status.textContent = 'Locating…';
				navigator.geolocation.getCurrentPosition(success, error);
			}

		}

		// keep watching the location
		const watchID = undefined;

		function startWatch(){
			if (!watchID){
				if(!navigator.geolocation) {
					status.textContent = 'Geolocation is not supported by your browser';
				} else {
					status.textContent = 'Locating…';
					watchID = navigator.geolocation.watchPosition(success, error);
				}
			}
		}

		function stopWatch(){
			status.textContent = '';
			navigator.geolocation.clearWatch(watchID);
			watchID = undefined;
		}

		document.querySelector('#find-me').addEventListener('click', geoFindMe);
		document.querySelector('#keep-watch').addEventListener('click', startWatch);
		document.querySelector('#stop-watch').addEventListener('click', stopWatch);

	</script>
</body>
</html>