<!DOCTYPE html>
<html>
<head>
	<title>Where am I</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
  		integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
 		crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
		integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
		crossorigin=""></script>
	<style>
		body,p{
			padding: 1%;
			margin: 0;
		}
		html, body, #map{
 	   		height: 70vh;
    		width: 98vw;
		}
		#arrow {
			border: solid black;
			border-width: 0 3px 3px 0;
			display: inline-block;
			padding: 10px;
			margin: 10px;
			transform: rotate(-135deg);
		}
	</style>
</head>
<body>
	
	<!--<a href="index.html">back to HOME</a>-->
	<h1>Where am I?</h1>
	<button id="find-me">Show my location</button>
	<button id="keep-watch">keep watching my location</button>
	<button id="stop-watch">stop watching</button>
	
	<p id = "status"></p>
	<p>Latitude: <span id = "latitude">_____</span>° | Longitude: <span id = "longitude">_____</span>° | 
		Heading: <span id = "heading"></span><br/>
	</p>
	<p><i id="arrow"></i></p> 
	<div id="map"></div>
	

	<script>
		// setup the map
		const mymap = L.map('map',{center:[22.40000, 114.13000],zoom: 11,minZoom:11,zoomControl: false});
		
		const pikachuIcon = L.icon({
			iconUrl: 'imges/pikachu.png',
			iconSize:     [30, 30], // size of the icon
			iconAnchor:   [15, 18], // point of the icon which will correspond to marker's location
			popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});
		const psyduckIcon = L.icon({
			iconUrl: 'imges/psyduck.png',
			iconSize:     [30, 30], // size of the icon
			iconAnchor:   [15, 18], // point of the icon which will correspond to marker's location
			popupAnchor:  [0, -18] // point from which the popup should open relative to the iconAnchor
		});
		const charmanderIcon = L.icon({
			iconUrl: 'imges/charmander.png',
			iconSize:     [30, 30], // size of the icon
			iconAnchor:   [15, 18], // point of the icon which will correspond to marker's location
			popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});
		const snorlaxIcon = L.icon({
			iconUrl: 'imges/snorlax.png',
			iconSize:     [30, 30], // size of the icon
			iconAnchor:   [15, 18], // point of the icon which will correspond to marker's location
			popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});

		const user = L.marker([22.40000, 114.13000],{icon: pikachuIcon}).addTo(mymap);
		

		//https://api.mapbox.com/styles/v1/sunnywongws/cl3dxr94u000p14o2ywsmaj7t/wmts?access_token=pk.eyJ1Ijoic3Vubnl3b25nd3MiLCJhIjoiY2wzZHMxNXFrMDN2OTNibWszaWp4MWx2MiJ9.6avIlC_w3PH1x5OIzjyn9A
		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
			maxZoom: 19,
			id: 'sunnywongws/cl3dxr94u000p14o2ywsmaj7t',
			tileSize: 512,
			zoomOffset: -1,
			accessToken: 'pk.eyJ1Ijoic3Vubnl3b25nd3MiLCJhIjoiY2wzZHM3ejZwMGJqNDNtcHJzbjg3enRkNCJ9.xxoXiVlJOXyoSr1QFQ0gFg'
		}).addTo(mymap);

		const status = document.querySelector('#status');
		// let firsTime = true;
		const text = 'Some text here about the place.';


		function success(position) {
			//console.log(position)
			const latitude  = position.coords.latitude;
			const longitude = position.coords.longitude;
			const heading = Math.round(position.coords.heading);
			
			document.querySelector( '#heading' ).innerHTML = heading;
			document.querySelector( '#latitude' ).innerHTML = latitude.toFixed(2); 
			document.querySelector( '#longitude' ).innerHTML = longitude.toFixed(2); 
			document.querySelector( '#arrow' ).style.transform = 'rotate('+ (-135+heading) +'deg)';

			status.textContent = '';

			user.setLatLng([latitude, longitude]);
			mymap.flyTo([latitude, longitude], 19);
			/*if (firsTime){
				mymap.flyTo([latitude, longitude], 19);
				firsTime = false;
			}*/
			
			const psyduck = L.marker([22.36175, 114.13281],{icon: psyduckIcon}).addTo(mymap);
			const charmander = L.marker([22.3626, 114.13344],{icon: charmanderIcon}).addTo(mymap);
			const snorlax = L.marker([22.36339, 114.13224],{icon: snorlaxIcon}).addTo(mymap);
			psyduck.bindPopup(text);

			}

		function error(error) {
			status.textContent = 'Unable to retrieve your location';
			// Display error based on the error code.
			const { code } = error;
			switch (code) {
				case GeolocationPositionError.TIMEOUT:
				break;
				case GeolocationPositionError.PERMISSION_DENIED:
				break;
				case GeolocationPositionError.POSITION_UNAVAILABLE:
				break;
			}
		}

		var options = {
			enableHighAccuracy: true
		};

		// show the location once
		function geoFindMe() {
			if(!navigator.geolocation) {
				status.textContent = 'Geolocation is not supported by your browser';
			} else {
				status.textContent = 'Locating…';
				navigator.geolocation.getCurrentPosition(success, error, options);
			}
		}

		// keep watching the location
		var watchID;

		function startWatch(){
			if (!watchID){
				if(!navigator.geolocation) {
					status.textContent = 'Geolocation is not supported by your browser';
				} else {
					status.textContent = 'Locating…';
					watchID = navigator.geolocation.watchPosition(success, error, options);
				}
			}
		}

		function stopWatch(){
			status.textContent = '';
			navigator.geolocation.clearWatch(watchID);
			watchID = undefined;
		}

		document.querySelector('#find-me').addEventListener('click', geoFindMe);
		document.querySelector('#keep-watch').addEventListener('click', startWatch);
		document.querySelector('#stop-watch').addEventListener('click', stopWatch);

	</script>
</body>
</html>