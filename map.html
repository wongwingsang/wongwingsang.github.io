<!DOCTYPE html>
<html>
<head>
	<title>Where am I</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
  		integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
 		crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
		integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
		crossorigin=""></script>
	<style>
		body{
			padding: 1%;
			margin: 0;
		}
		html, body, #map{
 	   		height: 60vh;
    		width: 80vw;
		}
	</style>
</head>
<body>
	
	<a href="index.html">back to HOME</a>
	<h1>Where am I?</h1>
	<button id="find-me">Show my location</button>
	<p id = "status"></p>
	<a id = "map-link" target="_blank"></a><br/>
	<div id="map"></div>
	

	<script>
		const map = L.map('map',{
			center:[0,0],
			zoom: 2,
		});
		const marker = L.marker([0, 0]).addTo(map);

		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
			maxZoom: 18,
			id: 'mapbox/streets-v11',
			tileSize: 512,
			zoomOffset: -1,
			accessToken: 'pk.eyJ1Ijoic3Vubnl3b25nd3MiLCJhIjoiY2wzZHM3ejZwMGJqNDNtcHJzbjg3enRkNCJ9.xxoXiVlJOXyoSr1QFQ0gFg'
		}).addTo(map);

		function geoFindMe() {

			const status = document.querySelector('#status');
			const mapLink = document.querySelector('#map-link');

			mapLink.href = '';
			mapLink.textContent = '';

			function success(position) {
				const latitude  = position.coords.latitude;
				const longitude = position.coords.longitude;

				status.textContent = '';
				// mapLink.href = `https://www.openstreetmap.org/#map=18/${latitude}/${longitude}`;
				mapLink.href = `https://www.google.com/maps/place/${latitude},${longitude}`;
				mapLink.textContent = `Latitude: ${latitude} °, Longitude: ${longitude} °`;

				marker.setLatLng([latitude, longitude]);
				map.setView([latitude, longitude], 18);
				// map.locate({setView: true, Zoom: 13});

			}

			function error() {
				status.textContent = 'Unable to retrieve your location';
			}

			if(!navigator.geolocation) {
				status.textContent = 'Geolocation is not supported by your browser';
			} else {
				status.textContent = 'Locating…';
				navigator.geolocation.getCurrentPosition(success, error);
			}

		}

		/*function keepFindMe(){
			setInterval(geoFindMe, 1000);
		}*/

		document.querySelector('#find-me').addEventListener('click', geoFindMe);
		//geoFindMe();

		
	</script>
</body>
</html>